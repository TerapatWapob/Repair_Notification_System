@model List<RPS_DB.Models.Ticket>

<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
<style>
    .header-bg {
        background-color: #007BFF;
        color: white;
        padding: 12px;
        text-align: center;
        border-radius: 10px;
        text-shadow: -2px -2px 0 black, 2px -2px 0 black, -2px 2px 0 black, 2px 2px 0 black;
    }
    .col-9 {
        background-color: #007BFF;
        color: white;
        padding: 10px;
        border-radius: 0px;
    }
    .col-3 {
        background-color: #007BFF;
        color: white;
        padding: 10px;
        border-radius: 0px;
    }
    .responsive-text {
        font-size: clamp(16px, 4vw, 24px); /* Responsive ticket text size */
    }
</style>

<br>

<div class="text-left d-flex justify-content-between align-items-center">
    <h4>รายการแจ้งซ่อมในระบบ</h4>
    <div class="input-group input-group-sm" style="max-width: 300px;">
        @using (Html.BeginForm("Index", "Home", FormMethod.Get))
        {
            <input type="text" name="searchTerm" value="@ViewData["SearchTerm"]" class="form-control" placeholder="ค้นหาจากชื่อผู้แจ้งซ่อม" aria-label="Search">
        }
        <button class="btn btn-primary text-white" type="submit">
                <i class="fas fa-search"></i> ค้นหา
        </button>
    </div>
</div>

<div class="container mt-5">
    <div class="header-bg text-center mb-4">
        @foreach (var ticket in Model.OrderByDescending(t => t.StartDate))
        {
            // Show tickets with EndDate within 14 days
            if (ticket.EndDate != null)
            {
                var timeSpan = ticket.EndDate - ticket.StartDate;
                if (timeSpan.HasValue && timeSpan.Value.Days <= 14)
                {
                    <div class="row">
                        <div class="col-3 text-start responsive-text">เรื่อง</div>
                        <div class="col-9 text-end responsive-text">@ticket.Topic (@ticket.Name)</div>
                    </div>
                    <div class="row">
                        <div class="col-3 text-start responsive-text">สถานะ</div>
                        <div class="col-9 text-end responsive-text">@ticket.State</div>
                    </div>
                    <div class="row">
                        <div class="col-3 text-start responsive-text">วันที่แจ้ง</div>
                        <div class="col-9 text-end responsive-text">@ticket.StartDate?.ToString("dd/MM/yyyy")</div>
                    </div>
                    <hr/>
                }
            }
            // Show tickets without EndDate
            else
            {
                <div class="row">
                    <div class="col-3 text-start responsive-text">เรื่อง</div>
                    <div class="col-9 text-end responsive-text">@ticket.Topic (@ticket.Name)</div>
                </div>
                <div class="row">
                    <div class="col-3 text-start responsive-text">สถานะ</div>
                    <div class="col-9 text-end responsive-text">@ticket.State</div>
                </div>
                <div class="row">
                    <div class="col-3 text-start responsive-text">วันที่แจ้ง</div>
                    <div class="col-9 text-end responsive-text">@ticket.StartDate?.ToString("dd/MM/yyyy")</div>
                </div>
                <hr/>
            }
        }
    </div>
</div>
